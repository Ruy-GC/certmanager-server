name: "Rspec tests"
on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
jobs:
    test:
        runs-on: ubuntu-latest
        name: Run Rspec Tests
        services:
          mysql:
            image: mysql:5.7
            env:
              MYSQL_HOST: ibmserver.mysql.database.azure.com
              MYSQL_USER: slyfox
              MYSQL_PASSWORD: ACRRS14!
              MYSQL_DATABASE: test
            ports:
              - "3306:3306"
        env:
          RAILS_ENV: test

        steps:
            - name: "Checkout repository"
              uses: actions/checkout@v1

            - name: "Setup ruby & start MySQL"
              uses: ruby/setup-ruby@v1
              with:
                ruby-version: '3.2.2'
                bundler-cache: true
            - run: sudo /etc/init.d/mysql start
                
            - name: "Authentication spec"
              run: bundle exec rspec ./spec/requests/authentication_spec.rb
